<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Preenchimento de Receita</title>

<script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js" defer></script>

<style>
body{margin:0;font-family:Arial,sans-serif;background:#f4f4f4}
.container{max-width:700px;margin:auto;padding:16px}
h1{text-align:center;margin-bottom:20px}
.campo{margin-bottom:16px}
label{font-weight:bold;display:block;margin-bottom:6px}
input,select,textarea,button{width:100%;padding:12px;font-size:16px;box-sizing:border-box}
button{background:#27ae60;color:#fff;border:none;border-radius:6px;cursor:pointer}
.medicacao-box{background:#fff;border:1px solid #ccc;padding:10px;margin-bottom:10px}
.medicacao-linha{display:flex;gap:6px;align-items:center}
.num{width:32px;font-weight:bold;text-align:center}
.btn-apagar{background:#e74c3c}
.btn-lupa{background:#34495e}
.btn-add{background:#2980b9;margin-top:8px}

/* SIDEBAR */
.sidebar{
  position:fixed;
  top:0;right:-100%;
  width:100%;height:100%;
  background:#fff;
  padding:16px;
  overflow-y:auto;
  transition:.3s;
  z-index:999
}
.sidebar.open{right:0}
.categoria{font-weight:bold;margin-top:14px}
.item{padding:6px;border-bottom:1px dashed #ccc;cursor:pointer}
.item:hover{background:#f0f0f0}
.close{background:#e74c3c;margin-bottom:10px}
</style>
</head>

<body>

<div class="container">
<h1>Receita M√©dica</h1>

<div class="campo">
<label>Selecionar PDF base</label>
<input type="file" id="pdfBase" accept="application/pdf">
</div>

<div class="campo">
<label>NOME DO PACIENTE</label>
<input id="nomePaciente" oninput="this.value=this.value.toUpperCase()">
</div>

<div class="campo">
<label>USO</label>
<select id="uso">
<option value="">Selecione</option>
<option>USO ORAL</option>
<option>USO T√ìPICO</option>
</select>
</div>

<div class="campo">
<label>MEDICA√á√ïES</label>
<div id="listaMedicacoes"></div>
<button class="btn-add" onclick="adicionarMedicacao()">‚ûï Adicionar Medica√ß√£o</button>
</div>

<button onclick="gerarPDF()">üìÑ Gerar PDF</button>
</div>

<!-- SIDEBAR -->
<div id="sidebar" class="sidebar">
<button class="close" onclick="fecharSidebar()">Fechar</button>
<input placeholder="Buscar..." oninput="renderizarLista(this.value)">
<div id="listaSidebar"></div>
</div>

<script>
const LIMITE=8;
let campoAtual=null;

/* ===== BANCO ===== */
const banco=[
{c:"‚ù§Ô∏è Hipertens√£o / Cardiovascular",n:"HIDROCLOROTIAZIDA 25MG ‚Äì 60+60+60+60 CP",u:"TOMAR 1 CP CEDO E 1 CP √Ä NOITE"},
{c:"‚ù§Ô∏è Hipertens√£o / Cardiovascular",n:"LOSARTANA POT√ÅSSICA 50MG ‚Äì 60+60+60+60 CP",u:"TOMAR 1 CP CEDO E 1 CP √Ä NOITE"},
{c:"‚ù§Ô∏è Hipertens√£o / Cardiovascular",n:"LOSARTANA POT√ÅSSICA 30MG ‚Äì 60/60/60 CP",u:"TOMAR 1 CP 12/12H"},
{c:"‚ù§Ô∏è Hipertens√£o / Cardiovascular",n:"CARVEDILOL 6,25MG ‚Äì 60/60/60 CP",u:"TOMAR 1 CP VO 12/12H"},
{c:"‚ù§Ô∏è Hipertens√£o / Cardiovascular",n:"FUROSEMIDA 40MG ‚Äì 30/30/30 CP",u:"TOMAR MEIO CP AO DIA"},
{c:"‚ù§Ô∏è Hipertens√£o / Cardiovascular",n:"ESPIRONOLACTONA 25MG ‚Äì 30/30/30 CP",u:"TOMAR 1 CP CEDO"},
{c:"‚ù§Ô∏è Hipertens√£o / Cardiovascular",n:"DIGOXINA 0,25MG ‚Äì 30/30/30 CP",u:"TOMAR MEIO CP AO DIA"},
{c:"ü´Å Asma / Doen√ßas respirat√≥rias",n:"AEROLIN SPRAY ‚Äì 1 UNIDADE",u:"ASPIRAR 2 JATOS DE 8/8H SE FALTA DE AR"},
{c:"ü§ß Antial√©rgicos",n:"DEXCLORFENIRAMINA 2MG ‚Äì 20 CP",u:"TOMAR 1 CP DE 8/8H"},
{c:"üíä Dor / Febre",n:"PARACETAMOL 500MG ‚Äì 24 CP",u:"TOMAR 1 CP VO DE 6/6H"},
{c:"ü¶† Antibi√≥ticos",n:"AMOXICILINA 500MG ‚Äì 30 CP",u:"TOMAR 2 CP DE 8/8H"}
];

/* ===== MEDICA√á√ïES ===== */
function adicionarMedicacao(){
 if(document.querySelectorAll(".medicacao-box").length>=LIMITE)
   return alert("Limite de 8 medica√ß√µes.");
 const d=document.createElement("div");
 d.className="medicacao-box";
 d.innerHTML=`
 <div class="medicacao-linha">
  <div class="num"></div>
  <input class="med1">
  <button class="btn-lupa" onclick="abrirSidebar(this)">üîç</button>
  <button class="btn-apagar" onclick="this.closest('.medicacao-box').remove();num()">APAGAR</button>
 </div>
 <textarea class="med2"></textarea>`;
 document.getElementById("listaMedicacoes").appendChild(d);
 num();
}
function num(){
 document.querySelectorAll(".num").forEach((e,i)=>e.textContent=(i+1)+")");
}

/* ===== SIDEBAR ===== */
function abrirSidebar(btn){
 campoAtual=btn.closest(".medicacao-box");
 document.getElementById("sidebar").classList.add("open");
 renderizarLista();
}
function fecharSidebar(){
 document.getElementById("sidebar").classList.remove("open");
}
function renderizarLista(f=""){
 const l=document.getElementById("listaSidebar");
 l.innerHTML="";
 let cat="";
 banco.filter(m=>(m.n+m.u).includes(f.toUpperCase())).forEach(m=>{
  if(m.c!==cat){
    cat=m.c;
    const c=document.createElement("div");
    c.className="categoria";
    c.textContent=m.c;
    l.appendChild(c);
  }
  const i=document.createElement("div");
  i.className="item";
  i.innerHTML=`<strong>${m.n}</strong><br>${m.u}`;
  i.onclick=()=>{
    campoAtual.querySelector(".med1").value=m.n;
    campoAtual.querySelector(".med2").value=m.u;
    fecharSidebar();
  };
  l.appendChild(i);
 });
}

/* ===== PDF ===== */
async function gerarPDF(){
 const file=document.getElementById("pdfBase").files[0];
 if(!file) return alert("Selecione o PDF base.");
 const pdf=await PDFLib.PDFDocument.load(await file.arrayBuffer());
 const font=await pdf.embedFont(PDFLib.StandardFonts.TimesRoman);
 const p=pdf.getPages()[0];

 p.drawText(nomePaciente.value,{x:188,y:1361.5,size:28,font});
 p.drawText(nomePaciente.value,{x:1370.25,y:1361.5,size:28,font});

 if(uso.value){
  p.drawText(uso.value,{x:406.4,y:1150.64,size:25,font});
  p.drawText(uso.value,{x:1587.4,y:1150.64,size:25,font});
 }

 let y=1009.17;
 document.querySelectorAll(".medicacao-box").forEach((b,i)=>{
  const t=`${i+1}) ${b.querySelector(".med1").value}\n${b.querySelector(".med2").value}`;
  p.drawText(t,{x:157,y,size:25,font,lineHeight:30});
  p.drawText(t,{x:1339.33,y,size:25,font,lineHeight:30});
  y-=120;
 });

 const blob=new Blob([await pdf.save()],{type:"application/pdf"});
 const a=document.createElement("a");
 a.href=URL.createObjectURL(blob);
 a.download="receita.pdf";
 a.click();
}
</script>

</body>
</html>
