<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Preenchimento de Receita</title>

<!-- ðŸ”¥ FIREBASE (ADICIONADO, SEM REMOVER NADA) -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

<!-- PDF-LIB -->
<script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>

<style>
/* ===== TODO SEU CSS ORIGINAL (INTOCADO) ===== */
body{margin:0;font-family:Arial,sans-serif;background:#f4f4f4}
.container{max-width:750px;margin:auto;padding:16px}
h1{text-align:center;margin-bottom:20px}
.campo{margin-bottom:16px}
label{font-weight:bold;display:block;margin-bottom:6px}

input,select,textarea{
  width:100%;
  padding:12px;
  font-size:16px;
  box-sizing:border-box
}

button{
  padding:12px;
  font-size:16px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  background:#27ae60;
  color:#fff;
}

.medicacao-box{background:#fff;border:1px solid #ccc;padding:10px;margin-bottom:10px}
.medicacao-linha{display:flex;gap:6px;align-items:center}
.num{width:32px;font-weight:bold;text-align:center}
.btn-apagar{background:#e74c3c}
.btn-lupa{background:#34495e}
.btn-add{background:#2980b9;margin-top:8px}

.data-box{display:flex;gap:10px}
.data-box input{text-align:center}

.sidebar{
  position:fixed;
  inset:0;
  background:#fff;
  z-index:999;
  display:none;
  flex-direction:column;
}

.sidebar-topo{background:#e74c3c;padding:6px 10px}
.sidebar-topo button{background:#c0392b;padding:6px 10px;font-size:14px}
.sidebar-busca{padding:8px}
.sidebar-busca input{padding:6px 8px;font-size:13px;height:32px}
.sidebar-lista{flex:1;overflow-y:auto;padding:6px 8px}

.categoria{font-weight:bold;margin:10px 0 4px;font-size:14px}
.item{padding:6px 4px;border-bottom:1px dashed #ccc;font-size:14px;cursor:pointer}
.item:hover{background:#f0f0f0}

.acoes-item{display:flex;gap:6px;margin-top:6px}
.acoes-item button{flex:1;font-size:12px;padding:6px;border-radius:4px}
.btn-editar-item{background:#f1c40f;color:#000}
.btn-excluir-item{background:#e74c3c}
</style>
</head>

<body>

<div class="container">
<h1>Receita MÃ©dica</h1>

<div class="campo">
<label>Selecionar PDF base</label>
<input type="file" id="pdfBase" accept="application/pdf">
</div>

<div class="campo">
<label>NOME DO PACIENTE</label>
<input id="nomePaciente" oninput="this.value=this.value.toUpperCase()">
</div>

<div class="campo">
<label>USO</label>
<select id="uso">
<option value="">Selecione</option>
<option>USO ORAL</option>
<option>USO TÃ“PICO</option>
</select>
</div>

<div class="campo">
<label>MEDICAÃ‡Ã•ES</label>
<div id="listaMedicacoes"></div>
<button type="button" class="btn-add" onclick="adicionarMedicacao()">âž• Adicionar MedicaÃ§Ã£o</button>
</div>

<div class="campo">
<label>DATA</label>
<div class="data-box">
<input id="dataDia" placeholder="DD" maxlength="2">
<input id="dataMes" placeholder="MM" maxlength="2">
<input id="dataAno" placeholder="AAAA" maxlength="4">
</div>
</div>

<button type="button" onclick="gerarPDF()">ðŸ“„ Gerar PDF</button>
</div>

<!-- SIDEBAR -->
<div id="sidebar" class="sidebar">
  <div class="sidebar-topo">
    <button type="button" onclick="fecharSidebar()">Fechar</button>
  </div>
  <div class="sidebar-busca">
    <input placeholder="Buscar..." oninput="renderizarLista(this.value)">
  </div>
  <div id="listaSidebar" class="sidebar-lista"></div>
</div>

<script>
/* ===== SEU JS ORIGINAL (INTOCADO) ===== */
const LIMITE = 8;
let campoAtual = null;

function cap(t){
 if(!t) return "";
 return t[0].toUpperCase() + t.slice(1);
}

/* BANCO LOCAL (MANTIDO) */
const banco = [
 {c:"MedicaÃ§Ãµes",n:"Dipirona 500mg",u:"Tomar 1 CP de 6/6h"},
 {c:"MedicaÃ§Ãµes",n:"Paracetamol 750mg",u:"Tomar 1 CP de 8/8h"}
];

/* ===== ðŸ”¥ FIREBASE (APENAS ADICIONADO) ===== */
firebase.initializeApp({
 apiKey: "SUA_API_KEY",
 authDomain: "SEU_PROJETO.firebaseapp.com",
 projectId: "SEU_PROJETO"
});

const db = firebase.firestore();
let firebaseAtivo = true;

/* ðŸ”„ CARREGAR DO FIREBASE */
async function syncFirebase(){
 try{
  const snap = await db.collection("medicacoes").get();
  if(!snap.empty){
   banco.length = 0;
   snap.forEach(d=>banco.push(d.data()));
  }
 }catch(e){
  firebaseAtivo = false;
 }
}

/* ðŸ”¼ SALVAR NO FIREBASE */
async function salvarFirebase(m){
 if(!firebaseAtivo) return;
 await db.collection("medicacoes").add(m);
}

/* ðŸ—‘ï¸ APAGAR NO FIREBASE */
async function apagarFirebase(nome,uso){
 if(!firebaseAtivo) return;
 const q=await db.collection("medicacoes")
  .where("n","==",nome)
  .where("u","==",uso)
  .get();
 q.forEach(d=>d.ref.delete());
}

/* ===== HOOKS (SEM REMOVER FUNÃ‡Ã•ES) ===== */
const _abrirSidebar = abrirSidebar;
abrirSidebar = async function(btn){
 await syncFirebase();
 _abrirSidebar(btn);
};

const _apagarItem = apagarItem;
apagarItem = async function(nome,uso){
 await apagarFirebase(nome,uso);
 _apagarItem(nome,uso);
};

/* ===== RESTO DO SEU CÃ“DIGO ORIGINAL CONTINUA ===== */
</script>

</body>
</html>
