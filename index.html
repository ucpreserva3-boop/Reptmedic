<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">

<!-- ObrigatÃ³rio para iOS / Safari -->
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

<title>Preenchimento de Receita</title>

<!-- pdf-lib (compatÃ­vel com GitHub Pages / iOS) -->
<script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js" defer></script>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #f4f4f4;
}

.container {
  max-width: 600px;
  margin: auto;
  padding: 16px;
}

h1 {
  text-align: center;
  margin-bottom: 24px;
}

.campo {
  margin-bottom: 18px;
}

label {
  display: block;
  font-weight: bold;
  margin-bottom: 6px;
}

input, select, button {
  width: 100%;
  padding: 14px;
  font-size: 16px;
  box-sizing: border-box;
}

button {
  background: #27ae60;
  color: #fff;
  border: none;
  border-radius: 8px;
  cursor: pointer;
}
</style>
</head>

<body>

<div class="container">

  <h1>Receita MÃ©dica</h1>

  <!-- PDF BASE -->
  <div class="campo">
    <label>Selecionar PDF base</label>
    <input type="file" id="pdfBase" accept="application/pdf">
  </div>

  <!-- NOME DO PACIENTE -->
  <div class="campo">
    <label>NOME DO PACIENTE</label>
    <input
      id="nomePaciente"
      placeholder="Digite o nome completo"
      oninput="this.value = this.value.toUpperCase()"
    >
  </div>

  <!-- USO -->
  <div class="campo">
    <label>USO</label>
    <select id="uso">
      <option value="">Selecione</option>
      <option value="USO ORAL">USO ORAL</option>
      <option value="USO TÃ“PICO">USO TÃ“PICO</option>
    </select>
  </div>

  <!-- GERAR PDF -->
  <button onclick="gerarPDF()">ðŸ“„ Gerar PDF</button>

</div>

<script>
async function gerarPDF() {
  try {
    const file = document.getElementById("pdfBase").files[0];
    if (!file) {
      alert("Selecione o PDF base.");
      return;
    }

    const nome = document
      .getElementById("nomePaciente")
      .value
      .toUpperCase()
      .trim();

    if (!nome) {
      alert("Informe o nome do paciente.");
      return;
    }

    const uso = document.getElementById("uso").value;
    if (!uso) {
      alert("Selecione o tipo de uso.");
      return;
    }

    // LÃª o PDF base
    const pdfBytes = await file.arrayBuffer();
    const pdfDoc = await PDFLib.PDFDocument.load(pdfBytes);

    // Fonte Times New Roman
    const font = await pdfDoc.embedFont(PDFLib.StandardFonts.TimesRoman);

    const page = pdfDoc.getPages()[0];

    /* ===== NOME DO PACIENTE â€” ESQUERDO ===== */
    page.drawText(nome, {
      x: 188.00,
      y: 1361.50,
      size: 28,
      font
    });

    /* ===== NOME DO PACIENTE â€” DIREITO ===== */
    page.drawText(nome, {
      x: 1370.25,
      y: 1361.50,
      size: 28,
      font
    });

    /* ===== USO â€” ESQUERDO ===== */
    page.drawText(uso, {
      x: 406.40,
      y: 1150.64,
      size: 25,
      font
    });

    /* ===== USO â€” DIREITO ===== */
    page.drawText(uso, {
      x: 1587.40,
      y: 1150.64,
      size: 25,
      font
    });

    // Salva PDF
    const pdfFinal = await pdfDoc.save();
    const blob = new Blob([pdfFinal], { type: "application/pdf" });

    // Download compatÃ­vel com Safari iOS
    const url = URL.createObjectURL(blob);
    const link = document.createElement("a");
    link.href = url;
    link.download = "receita_nome_uso_preenchido.pdf";
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    URL.revokeObjectURL(url);

  } catch (err) {
    console.error(err);
    alert("Erro ao gerar o PDF.");
  }
}
</script>

</body>
</html>
