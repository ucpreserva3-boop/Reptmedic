<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Receita MÃ©dica</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>

<!-- PDF-LIB -->
<script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>

<style>
body{font-family:Arial;background:#f4f4f4;margin:0}
.container{max-width:750px;margin:auto;padding:16px}
h1{text-align:center}

input,select,textarea,button{
 width:100%;padding:12px;font-size:16px;margin-bottom:10px
}
button{background:#27ae60;color:#fff;border:none;border-radius:6px;cursor:pointer}
button.sair{background:#e74c3c}

#app{display:none}
#login{max-width:400px;margin:80px auto;background:#fff;padding:20px;border-radius:8px}

.medicacao-box{background:#fff;border:1px solid #ccc;padding:10px;margin-bottom:10px}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login">
<h2>Login</h2>
<input id="email" placeholder="Email">
<input id="senha" type="password" placeholder="Senha">
<button onclick="login()">Entrar</button>
<p id="erro" style="color:red"></p>
</div>

<!-- APP -->
<div id="app" class="container">
<h1>Receita MÃ©dica</h1>
<button class="sair" onclick="logout()">Sair</button>

<label>Selecionar PDF base</label>
<input type="file" id="pdfBase">

<label>Nome do paciente</label>
<input id="nomePaciente">

<label>Uso</label>
<select id="uso">
<option>USO ORAL</option>
<option>USO TÃ“PICO</option>
</select>

<div id="listaMedicacoes"></div>
<button onclick="adicionarMedicacao()">Adicionar MedicaÃ§Ã£o</button>

<label>Data</label>
<input id="dataDia" placeholder="DD">
<input id="dataMes" placeholder="MM">
<input id="dataAno" placeholder="AAAA">

<button onclick="gerarPDF()">Gerar PDF</button>
</div>

<script>
/* ðŸ”¥ FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyAhWOQRO47_RiBjj2RG4BXf7lhYy6KNiDg",
  authDomain: "receituario-3c175.firebaseapp.com",
  projectId: "receituario-3c175",
  storageBucket: "receituario-3c175.firebasestorage.app",
  messagingSenderId: "809180223495",
  appId: "1:809180223495:web:b6004647b7a0c6965f32a2"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();

/* ðŸ” LOGIN */
function login(){
 const email = document.getElementById("email").value;
 const senha = document.getElementById("senha").value;

 auth.signInWithEmailAndPassword(email, senha)
 .catch(e=>document.getElementById("erro").innerText="Login invÃ¡lido");
}

/* ðŸšª LOGOUT */
function logout(){
 auth.signOut();
}

/* ðŸ”„ ESTADO */
auth.onAuthStateChanged(user=>{
 if(user){
  document.getElementById("login").style.display="none";
  document.getElementById("app").style.display="block";
 }else{
  document.getElementById("login").style.display="block";
  document.getElementById("app").style.display="none";
 }
});

/* ðŸ’Š MEDICAÃ‡Ã•ES */
function adicionarMedicacao(){
 const d=document.createElement("div");
 d.className="medicacao-box";
 d.innerHTML=`
  <input placeholder="MedicaÃ§Ã£o">
  <textarea placeholder="Uso"></textarea>
 `;
 document.getElementById("listaMedicacoes").appendChild(d);
}

/* ðŸ“„ PDF */
async function gerarPDF(){
 const file=document.getElementById("pdfBase").files[0];
 if(!file) return alert("Selecione o PDF");

 const pdf=await PDFLib.PDFDocument.load(await file.arrayBuffer());
 const font=await pdf.embedFont(PDFLib.StandardFonts.TimesRoman);
 const p=pdf.getPages()[0];

 p.drawText(document.getElementById("nomePaciente").value,{x:150,y:700,size:20,font});

 const bytes=await pdf.save();
 const blob=new Blob([bytes],{type:"application/pdf"});
 const a=document.createElement("a");
 a.href=URL.createObjectURL(blob);
 a.download="receita.pdf";
 a.click();
}
</script>

</body>
</html>
